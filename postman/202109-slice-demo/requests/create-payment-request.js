// payloads and utils
const payloads = require('../payloads'),
      { readScript, getRequestID } = require('../../utils/fileUtils'),
      createItem = require('../../utils/createItem');

// The Request ID. This is made up and is only used because we need to pass an
// ID to Postman SDK.
const requestID = getRequestID(__filename);
const payload = payloads[requestID];

// The Request Description. This is used in the Postman.app to document what
// the Request does. It is displayed on the right-side of the UI.
const requestDescription = `
This request creates a payment request. It requires a payload which can be
automatically generated by running the \`MoveTaskOrders by ID\` request. The
collection variable \`serviceItemsToInvoice\` defines which service items are
populated in the payload. The payload is stored in \`paymentRequestPayload\`
collection variable.

Note the generated payload is also output to the console for easy debugging.

This request will store the payment request id in the collection var \`paymentRequestID\`.
`;

// Get the contents of the events/prerequest.js file
const requestPreRequestScript = readScript(__dirname, '../events/prerequest.js');

// Get the contents of the events/test.js file
const requestTestScript = readScript(__dirname, '../events/test.js');

module.exports = createItem({
  name: 'Create Payment Request',
  requestID: requestID,
  url: '{{baseUrl}}/payment-requests',
  method: 'POST',
  headers: {
    'Postman-Request-ID': requestID,
    'Content-Type': 'application/json',
  },
  description: requestDescription,
  payload: JSON.stringify(payload, null, 2).replace(/"{{/g, '{{').replace(/}}"/g, '}}'),
  prerequestScript: requestPreRequestScript,
  testScript: requestTestScript,
});
